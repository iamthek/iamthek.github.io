//================================================================================ 
// SuperMap IS .NET 客户端程序，版权所有，北京超图软件股份有限公司，2000-2008。 
// 本程序只能在有效的授权许可下使用。未经许可，不得以任何手段擅自使用或传播。 
// 作 者:  SuperMap IS Web Team 
// 版 本:  $Id: SuperMap.IS.QueryManager.js,v 1.22 2009/12/18 02:22:11 zhangyt Exp $
// 文 件:  SuperMap.IS.QueryManager.js 
// 描 述:  AjaxScripts 查询功能 
// 更 新:  $Date: 2009/12/18 02:22:11 $ 
//================================================================================ 
SuperMap.IS.QueryManager=function(S,O,R,T,K){var N=S+"query.ashx";var U=null;var G=null;var J=-1;var E="";var L=new Array();var W=new Array();var P=true;var H=true;if(K!=null){P=K}if(R!=null){J=R}if(T!=null){E=T}function I(X,Y){U=X;G=Y}this.RegisterHandler=I;function V(X,e,c,b,Z,d){function a(g){var h=eval("("+g+")");if(h==null){b(null,d);return }var f=new SuperMap.IS.ResultSet();f.FromJSON(h);if(H){M(f.trackingLayerIndex,f.userID,true)}if(b){b(f,d);f.Destroy();f=null}}var Y=new SuperMap.IS.RequestManager(N,a,Z,d);Y.AddQueryString("map",O);Y.AddQueryString("method",X);Y.AddQueryString("keepHighlight",P);Y.AddQueryStrings(e,c);Y.Send();Y.Destroy();Y=null;while(e.length>0){e.pop();c.pop()}e=null;c=null}this.QueryByPoint=function(X,Y,Z,b,a,c){H=D(Z);V("QueryByPoint",["point","tolerance","queryParam","trackingLayerIndex","userID"],[X,Y,Z,J,E],b,a,c)};this.QueryByLine=function(Y,X,a,Z,b){H=D(X);V("QueryByLine",["points","queryParam","trackingLayerIndex","userID"],[Y,X,J,E],a,Z,b)};this.QueryBySql=function(X,Z,Y,a){H=D(X);V("QueryBySql",["queryParam","trackingLayerIndex","userID"],[X,J,E],Z,Y,a)};this.QueryByRect=function(a,X,Z,Y,b){H=D(X);V("QueryByRect",["mapRect","queryParam","trackingLayerIndex","userID"],[a,X,J,E],Z,Y,b)};this.QueryByPolygon=function(Y,X,a,Z,b){H=D(X);V("QueryByPolygon",["points","queryParam","trackingLayerIndex","userID"],[Y,X,J,E],a,Z,b)};this.QueryByCircle=function(Y,X,Z,b,a,c){H=D(Z);V("QueryByCircle",["center","radius","queryParam","trackingLayerIndex","userID"],[Y,X,Z,J,E],b,a,c)};this.QueryByGeometry=function(b,X,Z,a,Y,c){H=D(X);V("QueryByGeometry",["geometry","queryParam","spatialQueryMode","trackingLayerIndex","userID"],[b,X,Z,J,E],a,Y,c)};this.Find=function(X,Z,Y,a){_attachTrackingLayer=D(X);V("Find",["queryParam","trackingLayerIndex","userID"],[X,J,E],Z,Y,a)};this.FindNearest=function(X,Y,Z,b,a,c){_attachTrackingLayer=D(Z);V("FindNearest",["point","tolerance","queryParam","trackingLayerIndex","userID"],[X,Y,Z,J,E],b,a,c)};this.FindNearestWithBounds=function(X,Y,Z,b,a,c){_attachTrackingLayer=D(Z);V("FindNearestWithBounds",["point","tolerance","queryParam","trackingLayerIndex","userID"],[X,Y,Z,J,E],b,a,c)};this.ExecuteGSQL=function(a,X,Z,Y,b){V("ExecuteGSQL",["gsql","highlight","trackingLayerIndex","userID"],[a,X,J,E],Z,Y,b)};this.StatisticsQuery=function(X,Z,Y,a){V("StatisticsQuery",["statisticsQueryParam"],[X],Z,Y,a)};function D(X){if(X==null){return true}if(X.highlight==null){return true}if(X.highlight.highlightResult||X.highlight.highlightQueryArea){return true}else{return false}}function B(X,Y){J=X;E=Y}function M(X,Y,Z){if(J!=X||E!=Y){J=X;E=Y;var a=new Object();a.trackingLayerIndex=J;a.userID=E;a.bSaveHistory=Z;A("onchangetrackinglayer",a)}}function F(Z,a){var Y=L[Z];if(!Y){Y=new Array();L[Z]=Y;W.push(Z)}for(var X=0;X<Y.length;X++){if(Y[X]==a){return true}}Y.push(a)}function C(Z,a){var Y=L[Z];if(!Y){return }for(var X=0;X<Y.length;X++){if(Y[X]==a){Y.splice(X,1)}}}function A(a,b,c){var Z=L[a];if(!Z){return }if(!b){b=Q()}var X=Z.concat();for(var Y=0;Y<X.length;Y++){if(X[Y]){X[Y](b,c)}}while(X.length>0){X.pop()}}function Q(X,Y){var Z=new Object();Z.trackingLayerIndex=J;Z.userID=E;if(!X){X=""}return new EventArguments(Z,X,Y)}this.AttachEvent=F;this.DetachEvent=C;this.ChangeTrackingLayerKey=B}
